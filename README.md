# 注意

ここで紹介しているやりかたは、 [Composer](http://getcomposer.org) を利用できない場合のための方法です。
利便性、メンテナンス性の観点から、 Composer を利用することが強く推奨されます。

Composer を利用する方法は、 [WebPayのライブラリ配布ページ](https://webpay.jp/docs/libraries#php) で説明しています。

# セットアップ方法

[WebPayのライブラリ配布ページ](https://webpay.jp/docs/libraries#php) から最新のパッケージ済みの webpay-php ライブラリを取得します。
`webpay-php-full.x.y.z.zip` (x.y.z はバージョン番号)というファイルをダウンロードし、解凍してください。
このドキュメント作成時の最新バージョンは webpay-php-fullー2.1.0 です。

あなたのプロジェクトでライブラリを配置している場所に、解凍してできたディレクトリを設置します。
今回はルートディレクトリの直下にしました。

PHP ファイルに、次のように記載することで WebPay ライブラリが使えるようになります。
くわしい使い方については [PHP APIドキュメント | WebPay: 開発者向けクレジットカード決済サービス](https://webpay.jp/docs/api/php) をご覧ください。

```php
require 'webpay-php-full-2.1.0/autoload.php';
use WebPay\WebPay;
```

# 手軽にためす

PHP 5.4 以降では、PHP コマンドに組み込みの HTTP サーバが付属しています。次のコマンドをルートディレクトリで実行してください。

```
php -S localhost:8080
```

ブラウザで http://localhost:8080 を開くとテストの支払い画面が表示されます。

組み込み HTTP サーバはインストール時の設定によっては利用できない事があります。その場合の動作確認の仕方は他の情報を参照してください。

# このサンプルコードの解説

このサンプルコードでは、安全なカード取引を提供するための最低限の方法を示しています。

まず最初に、あなたの WebPay アカウントに割り当てられたAPIキーを設定してください。
[ユーザ設定 | WebPay: 開発者向けクレジットカード決済サービス](https://webpay.jp/settings) からAPIキーを取得し、 `config.sample.php` に設定して、 `config.php` という名前で保存します。

ユーザは `index.php` を訪問し、支払金額を入力します。通常、この金額はユーザが選択した商品の値段から自動的に算出されます。

「カード情報を入力して支払う」を押すと、 WebPay が提供する Checkout という仕組みで、カード情報入力画面が出てきます。
ユーザが通常のフォームにカード番号などを入力し、あなたのサーバに送信する場合、クレジットカード情報を適切に扱う義務が発生します。
Checkout を利用するとカード番号は直接 WebPay に送信され、あなたのサーバを通過しないので、ユーザが安心して利用できます。
詳細は [トークン決済 | WebPay: 開発者向けクレジットカード決済サービス](https://webpay.jp/docs/payments_with_token) を確認してください。

カード情報を入力しおわると、自動的に `charge.php` に Checkout が生成したトークンと金額が送信されます。
`charge.php` では WebPay にライブラリを利用してアクセスし、課金をおこないます。
生成に成功すると支払い情報が、失敗するとエラーメッセージが表示されます。
